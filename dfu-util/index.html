<!DOCTYPE html>
<html>

<head>
  <link rel="stylesheet" type="text/css" href="../sakura.css" />
  <title>Kiwrious Sensor Update</title>
  <script src="dfu.js"></script>
  <script src="dfuse.js"></script>
  <script src="FileSaver.js"></script>
  <script src="dfu-util.js"></script>
  <style>
    p.warning {
      color: red;
    }

    p.error {
      color: red;
      font-weight: bold;
    }

    label.radio {
      display: inline;
    }

    input:invalid {
      color: red;
    }
  </style>
</head>

<body>

  <p>
    <span id="status" style="color: red;"></span>
  </p>
  <p>

    <input hidden="true" list="vendor_ids" type="text" name="vid" id="vid" maxlength="6" size="8"
      pattern="0x[A-Fa-f0-9]{1,4}" />
    <datalist id="vendor_ids">
      <option value="0x1209">dapboot DFU bootloader</option>
      <option value="0x0D28">mbed DAPLink</option>
      <option value="0x1EAF">LeafLabs Maple/stm32duino bootloader</option>
    </datalist>
  </p>
  <h2>Kiwrious Sensor Update Utility</h2>
  <ol>
    <li>Click Step 1 button and select the Kiwrious Sensor, sensor light should be flashing now</li>
    <li>Click Step 2 button and select the Kiwrious DFU</li>
    <li>Click Step 3, check Status below</li>
    <li>If you see "Done!", then the sensor update is complete. Please unplug the sensor and plug it back in.
      Otherwise, please contact us if any issues at <a href="mailto:support@kiwrious.com">support@kiwrious.com</a> </li>
  </ol>

  <button id="connectStep1">Step 1</button>
  >>
  <button id="connectStep2" disabled="true">Step 2</button>
  >>
  <button id="downloadStep3" disabled="true">Step 3</button>


  <dialog id="interfaceDialog">
    Your device has multiple DFU interfaces. Select one from the list below:
    <form id="interfaceForm" method="dialog">
      <button id="selectInterface" type="submit">Select interface</button>
    </form>
  </dialog>
  <p>
  <div id="usbInfo" style="white-space: pre"></div>
  <div id="dfuInfo" style="white-space: pre"></div>
  </p>
  <fieldset style="visibility: hidden;">
    <legend hidden="true">Runtime mode</legend>
    <button hidden="true" id="detach" disabled="true">Detach DFU</button>
  </fieldset>
  <fieldset>
    <form id="configForm">
      <input hidden="true" type="number" name="transferSize" id="transferSize" value="1024" />
      <div id="dfuseFields" hidden="true">
        <label for="dfuseStartAddress">DfuSe Start Address:</label>
        <input type="text" name="dfuseStartAddress" id="dfuseStartAddress"
          title="Initial memory address to read/write from (hex)" size="10" pattern="0x[A-Fa-f0-9]+" />
        <label for="dfuseUploadSize">DfuSe Upload Size:</label>
        <input type="number" name="dfuseUploadSize" id="dfuseUploadSize" min="1" />
      </div>

      <legend>Status</legend>
      <fieldset>
        <p>
          <input hidden="true" type="file" id="firmwareFile" name="file" disabled="true" />
        </p>
        <p>
        </p>
        <div class="log" id="downloadLog"></div>
      </fieldset>

    </form>
  </fieldset>
  <h4>About</h4>
  <p>
    This is a tool to update the firmware on Kiwrious Sensors. Based on the proof-of-concept demo by @devanlai. Source:
    <a href="https://devanlai.github.io/webdfu/dfu-util/">Git Repo</a>
  </p>
  <ul>
</body>

</html>